#include <stdio.h>
#include <stdlib.h>
#include "conio.h"
#include "maze.h"

int main(void) {
    int ch;
    int x = 1; // height
    int y = 2; // width
    int target_x = 14;
    int target_y = 26;
    char maze[HEIGHT][WIDTH] =
            {{'+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+'},
             {'+', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+'},
             {'+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+'},
             {'+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '+', ' ', ' ', ' ', '+'},
             {'+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', '+', ' ', ' ', ' ', '+'}};

    system("CLS");
    print_maze(maze);
    printf("Use arrow keys or wasd to move or enter q to quit.\n");

    while ((ch = getch()) != 'q') {
        if (ch == 0 || ch == 224) {
            // Use arrow keys
            switch (getch()) {
                case 72: // Up
                    move(maze, &x, &y, 0);
                    break;

                case 80: // Down
                    move(maze, &x, &y, 1);
                    break;

                case 77: // Right
                    move(maze, &x, &y, 2);
                    break;

                case 75: // Lift
                    move(maze, &x, &y, 3);
                    break;

                default:
                    break;
            }
        } else {
            // Use w a s d
            switch (ch) {
                case 'w':
                case 'W': // Up
                    move(maze, &x, &y, 0);
                    break;

                case 's':
                case 'S': // Down
                    move(maze, &x, &y, 1);
                    break;

                case 'd':
                case 'D': // Right
                    move(maze, &x, &y, 2);
                    break;

                case 'a':
                case 'A': // Lift
                    move(maze, &x, &y, 3);
                    break;

                default:
                    break;
            }
        }

        system("CLS");
        print_maze(maze);

        if (x == target_x && y == target_y) {
            printf("Success!\n");
            getchar();
            break;
        } else {
            printf("Use arrow keys or wasd to move or enter q to quit.\n");
        }
    }

    return 0;
}
